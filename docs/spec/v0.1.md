# Spec v0.1 (JSON)

TypeSpec からコンパイルされる JSON 仕様です。

> **Note**: 通常は TypeSpec を使います。JSON を直接書く必要はありません。

## 構造

```json
{
  "version": "0.1",
  "resources": [...],
  "views": [...]
}
```

## Resource

```json
{
  "name": "Post",
  "label": "投稿",
  "fields": [
    {
      "name": "id",
      "type": "string",
      "readonly": true
    },
    {
      "name": "title",
      "type": "string",
      "label": "タイトル",
      "kind": "text",
      "required": true,
      "validation": {
        "maxLength": 100
      }
    },
    {
      "name": "status",
      "type": "string",
      "label": "状態",
      "kind": "status",
      "ui": {
        "hint": "badge",
        "inputHint": "select"
      },
      "options": [
        { "value": "draft", "label": "下書き" },
        { "value": "published", "label": "公開中" }
      ]
    },
    {
      "name": "author",
      "type": "User",
      "label": "著者",
      "kind": "relation",
      "required": true,
      "relation": {
        "resource": "User",
        "labelField": "name"
      },
      "ui": {
        "hint": "avatar",
        "inputHint": "autocomplete",
        "searchable": true
      }
    },
    {
      "name": "tags",
      "type": "Tag[]",
      "label": "タグ",
      "kind": "relation",
      "relation": {
        "resource": "Tag",
        "labelField": "name"
      },
      "validation": {
        "maxItems": 5
      },
      "ui": {
        "inputHint": "autocomplete",
        "searchable": true
      }
    },
    {
      "name": "createdAt",
      "type": "datetime",
      "label": "作成日時",
      "kind": "datetime",
      "readonly": true
    }
  ],
  "validation": {
    "requiredOneOf": []
  }
}
```

## View

### List View

```json
{
  "resource": "Post",
  "type": "list",
  "columns": ["title", "status", "author", "createdAt"],
  "searchable": ["title", "body"],
  "sortable": ["title", "createdAt"],
  "defaultSort": {
    "field": "createdAt",
    "order": "desc"
  },
  "selection": "multi",
  "clickAction": "show",
  "namedFilters": [
    { "id": "all", "label": "すべて", "filter": {} },
    { "id": "published", "label": "公開中", "filter": { "status": "published" } },
    { "id": "draft", "label": "下書き", "filter": { "status": "draft" } }
  ],
  "actions": [
    {
      "id": "create",
      "label": "新規作成",
      "placement": "header",
      "allowedWhen": "role == 'admin' || role == 'editor'",
      "ui": { "icon": "plus", "variant": "primary" }
    },
    {
      "id": "delete",
      "label": "削除",
      "placement": "row",
      "allowedWhen": "role == 'admin'",
      "confirm": "本当に削除しますか？",
      "ui": { "icon": "trash", "variant": "danger" }
    }
  ]
}
```

### Form View

```json
{
  "resource": "Post",
  "type": "form",
  "fields": ["title", "body", "status", "author", "tags"],
  "actions": [
    {
      "id": "save",
      "label": "保存",
      "placement": "header",
      "ui": { "icon": "check", "variant": "primary" }
    },
    {
      "id": "cancel",
      "label": "キャンセル",
      "placement": "header"
    }
  ]
}
```

### Show View

```json
{
  "resource": "Post",
  "type": "show",
  "fields": ["title", "body", "status", "author", "tags", "createdAt", "updatedAt"],
  "actions": [
    {
      "id": "edit",
      "label": "編集",
      "placement": "header",
      "allowedWhen": "role == 'admin' || role == 'editor'",
      "ui": { "icon": "pencil" }
    },
    {
      "id": "publish",
      "label": "公開",
      "placement": "header",
      "allowedWhen": "status == 'draft'",
      "ui": { "icon": "globe", "variant": "primary" }
    }
  ]
}
```

## Field Types

| type | 説明 |
|------|------|
| string | 文字列 |
| int32 | 整数 |
| float64 | 小数 |
| boolean | 真偽値 |
| date | 日付 |
| datetime | 日時 |
| Model | 単一リレーション |
| Model[] | 複数リレーション |

## Validation

```json
{
  "validation": {
    "required": true,
    "minLength": 1,
    "maxLength": 100,
    "min": 0,
    "max": 100,
    "pattern": "email",
    "minItems": 1,
    "maxItems": 5
  }
}
```

## 完全な例

```json
{
  "version": "0.1",
  "resources": [
    {
      "name": "Post",
      "label": "投稿",
      "fields": [
        { "name": "id", "type": "string", "readonly": true },
        { "name": "title", "type": "string", "label": "タイトル", "kind": "text", "required": true },
        { "name": "body", "type": "string", "label": "本文", "kind": "longText" },
        { "name": "status", "type": "string", "label": "状態", "kind": "status" }
      ]
    }
  ],
  "views": [
    {
      "resource": "Post",
      "type": "list",
      "columns": ["title", "status"],
      "actions": []
    }
  ]
}
```
